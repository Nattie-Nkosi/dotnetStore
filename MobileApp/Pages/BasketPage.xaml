<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewmodels="clr-namespace:MobileApp.ViewModels"
             xmlns:models="clr-namespace:MobileApp.Models"
             x:Class="MobileApp.Pages.BasketPage"
             x:DataType="viewmodels:BasketViewModel"
             Title="Shopping Cart"
             BackgroundColor="#F5F5F5">

    <Grid RowDefinitions="*,Auto">

        <ScrollView Grid.Row="0">
            <VerticalStackLayout Spacing="16" Padding="16">

                <!-- Header -->
                <Border
                    Padding="20"
                    BackgroundColor="White"
                    StrokeThickness="0"
                    Margin="0,0,0,16">
                    <Border.StrokeShape>
                        <RoundRectangle CornerRadius="20" />
                    </Border.StrokeShape>
                    <Border.Shadow>
                        <Shadow Brush="#E0E0E0" Offset="0,2" Radius="8" Opacity="0.3" />
                    </Border.Shadow>
                    <HorizontalStackLayout Spacing="16" VerticalOptions="Center">
                        <Border
                            Padding="12"
                            BackgroundColor="#EDE7F6"
                            StrokeThickness="0"
                            HeightRequest="60"
                            WidthRequest="60">
                            <Border.StrokeShape>
                                <RoundRectangle CornerRadius="16" />
                            </Border.StrokeShape>
                            <Label
                                Text="ðŸ›’"
                                FontSize="36"
                                HorizontalOptions="Center"
                                VerticalOptions="Center" />
                        </Border>
                        <VerticalStackLayout Spacing="4" VerticalOptions="Center">
                            <Label
                                Text="Your Shopping Cart"
                                FontSize="26"
                                FontAttributes="Bold"
                                TextColor="#1A1A1A" />
                            <Label
                                Text="{Binding TotalItems, StringFormat='{0} items'}"
                                FontSize="15"
                                TextColor="#757575" />
                        </VerticalStackLayout>
                    </HorizontalStackLayout>
                </Border>

                <!-- Loading Indicator -->
                <ActivityIndicator
                    IsRunning="{Binding IsLoading}"
                    IsVisible="{Binding IsLoading}"
                    Color="#512BD4"
                    HeightRequest="40"
                    Margin="0,40,0,0" />

                <!-- Empty Cart Message -->
                <Border
                    Padding="40"
                    BackgroundColor="White"
                    StrokeThickness="0"
                    IsVisible="{Binding BasketItems.Count, Converter={StaticResource EqualConverter}, ConverterParameter=0}"
                    VerticalOptions="Center"
                    HorizontalOptions="Center"
                    Margin="0,40,0,0">
                    <Border.StrokeShape>
                        <RoundRectangle CornerRadius="24" />
                    </Border.StrokeShape>
                    <Border.Shadow>
                        <Shadow Brush="#E0E0E0" Offset="0,4" Radius="12" Opacity="0.3" />
                    </Border.Shadow>
                    <VerticalStackLayout Spacing="20" HorizontalOptions="Center">
                        <Label
                            Text="ðŸ›ï¸"
                            FontSize="96"
                            HorizontalOptions="Center" />
                        <Label
                            Text="Your cart is empty"
                            FontSize="24"
                            FontAttributes="Bold"
                            TextColor="#1A1A1A"
                            HorizontalOptions="Center" />
                        <Label
                            Text="Add some products to get started!"
                            FontSize="16"
                            TextColor="#757575"
                            HorizontalOptions="Center"
                            HorizontalTextAlignment="Center" />
                        <Border
                            StrokeThickness="0"
                            Margin="0,16,0,0">
                            <Border.StrokeShape>
                                <RoundRectangle CornerRadius="16" />
                            </Border.StrokeShape>
                            <Border.Background>
                                <LinearGradientBrush StartPoint="0,0" EndPoint="1,0">
                                    <GradientStop Color="#512BD4" Offset="0.0" />
                                    <GradientStop Color="#7B4FDB" Offset="1.0" />
                                </LinearGradientBrush>
                            </Border.Background>
                            <Border.Shadow>
                                <Shadow Brush="#512BD4" Offset="0,4" Radius="12" Opacity="0.3" />
                            </Border.Shadow>
                            <Button
                                Text="Start Shopping"
                                Command="{Binding ContinueShoppingCommand}"
                                BackgroundColor="Transparent"
                                TextColor="White"
                                FontSize="16"
                                FontAttributes="Bold"
                                HeightRequest="50"
                                Padding="32,0" />
                        </Border>
                    </VerticalStackLayout>
                </Border>

                <!-- Cart Items -->
                <CollectionView
                    ItemsSource="{Binding BasketItems}"
                    IsVisible="{Binding IsLoading, Converter={StaticResource InvertedBoolConverter}}"
                    SelectionMode="None">

                    <CollectionView.ItemTemplate>
                        <DataTemplate x:DataType="models:BasketItem">
                            <Border
                                StrokeThickness="0"
                                BackgroundColor="White"
                                Padding="0"
                                Margin="0,0,0,16">
                                <Border.StrokeShape>
                                    <RoundRectangle CornerRadius="20" />
                                </Border.StrokeShape>
                                <Border.Shadow>
                                    <Shadow Brush="#D0D0D0" Offset="0,4" Radius="12" Opacity="0.3" />
                                </Border.Shadow>

                                <Grid ColumnDefinitions="110,*,Auto" ColumnSpacing="16" Padding="12">

                                    <!-- Product Image -->
                                    <Border
                                        Grid.Column="0"
                                        Padding="10"
                                        BackgroundColor="#FAFAFA"
                                        StrokeThickness="0"
                                        HeightRequest="110"
                                        WidthRequest="110">
                                        <Border.StrokeShape>
                                            <RoundRectangle CornerRadius="16" />
                                        </Border.StrokeShape>
                                        <Image
                                            Source="{Binding FullImageUrl}"
                                            Aspect="AspectFit" />
                                    </Border>

                                    <!-- Product Info -->
                                    <VerticalStackLayout Grid.Column="1" Spacing="8" VerticalOptions="Center">

                                        <Label
                                            Text="{Binding Name}"
                                            FontSize="17"
                                            FontAttributes="Bold"
                                            TextColor="#1A1A1A"
                                            LineBreakMode="WordWrap"
                                            MaxLines="2" />

                                        <Border
                                            Padding="8,4"
                                            BackgroundColor="#EDE7F6"
                                            StrokeThickness="0"
                                            HorizontalOptions="Start">
                                            <Border.StrokeShape>
                                                <RoundRectangle CornerRadius="8" />
                                            </Border.StrokeShape>
                                            <Label
                                                Text="{Binding Brand}"
                                                FontSize="11"
                                                FontAttributes="Bold"
                                                TextColor="#512BD4" />
                                        </Border>

                                        <Label
                                            Text="{Binding FormattedPrice}"
                                            FontSize="20"
                                            FontAttributes="Bold"
                                            TextColor="#512BD4" />

                                        <Label
                                            Text="{Binding FormattedSubtotal, StringFormat='Subtotal: {0}'}"
                                            FontSize="14"
                                            FontAttributes="Bold"
                                            TextColor="#757575" />

                                    </VerticalStackLayout>

                                    <!-- Quantity Controls -->
                                    <VerticalStackLayout Grid.Column="2" Spacing="10" VerticalOptions="Center">

                                        <!-- Quantity Adjuster -->
                                        <Border
                                            Padding="6"
                                            StrokeThickness="2"
                                            Stroke="#EEEEEE">
                                            <Border.StrokeShape>
                                                <RoundRectangle CornerRadius="12" />
                                            </Border.StrokeShape>
                                            <VerticalStackLayout Spacing="6">
                                                <Button
                                                    Text="+"
                                                    FontSize="18"
                                                    FontAttributes="Bold"
                                                    BackgroundColor="#EDE7F6"
                                                    TextColor="#512BD4"
                                                    CornerRadius="8"
                                                    WidthRequest="44"
                                                    HeightRequest="44"
                                                    Padding="0"
                                                    Command="{Binding Source={RelativeSource AncestorType={x:Type viewmodels:BasketViewModel}}, Path=IncreaseQuantityCommand}"
                                                    CommandParameter="{Binding .}" />

                                                <Border
                                                    BackgroundColor="#FAFAFA"
                                                    StrokeThickness="0"
                                                    HeightRequest="36"
                                                    WidthRequest="44">
                                                    <Border.StrokeShape>
                                                        <RoundRectangle CornerRadius="8" />
                                                    </Border.StrokeShape>
                                                    <Label
                                                        Text="{Binding Quantity}"
                                                        FontSize="18"
                                                        FontAttributes="Bold"
                                                        TextColor="#1A1A1A"
                                                        HorizontalOptions="Center"
                                                        VerticalOptions="Center"
                                                        HorizontalTextAlignment="Center"
                                                        VerticalTextAlignment="Center" />
                                                </Border>

                                                <Button
                                                    Text="âˆ’"
                                                    FontSize="18"
                                                    FontAttributes="Bold"
                                                    BackgroundColor="#EDE7F6"
                                                    TextColor="#512BD4"
                                                    CornerRadius="8"
                                                    WidthRequest="44"
                                                    HeightRequest="44"
                                                    Padding="0"
                                                    Command="{Binding Source={RelativeSource AncestorType={x:Type viewmodels:BasketViewModel}}, Path=DecreaseQuantityCommand}"
                                                    CommandParameter="{Binding .}" />
                                            </VerticalStackLayout>
                                        </Border>

                                        <!-- Remove Button -->
                                        <Border
                                            Padding="10"
                                            BackgroundColor="#FFEBEE"
                                            StrokeThickness="0">
                                            <Border.StrokeShape>
                                                <RoundRectangle CornerRadius="12" />
                                            </Border.StrokeShape>
                                            <Border.Shadow>
                                                <Shadow Brush="#F44336" Offset="0,2" Radius="6" Opacity="0.2" />
                                            </Border.Shadow>
                                            <Button
                                                Text="ðŸ—‘ï¸"
                                                FontSize="20"
                                                BackgroundColor="Transparent"
                                                TextColor="#F44336"
                                                WidthRequest="44"
                                                HeightRequest="44"
                                                Padding="0"
                                                Command="{Binding Source={RelativeSource AncestorType={x:Type viewmodels:BasketViewModel}}, Path=RemoveItemCommand}"
                                                CommandParameter="{Binding .}" />
                                        </Border>

                                    </VerticalStackLayout>

                                </Grid>
                            </Border>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>

                <!-- Clear Cart Button -->
                <Border
                    Padding="16,12"
                    BackgroundColor="Transparent"
                    StrokeThickness="2"
                    Stroke="#FFCDD2"
                    IsVisible="{Binding BasketItems.Count, Converter={StaticResource EqualConverter}, ConverterParameter=0, Converter={StaticResource InvertedBoolConverter}}"
                    Margin="0,4,0,20">
                    <Border.StrokeShape>
                        <RoundRectangle CornerRadius="16" />
                    </Border.StrokeShape>
                    <Button
                        Text="ðŸ—‘ï¸ Clear Cart"
                        Command="{Binding ClearBasketCommand}"
                        BackgroundColor="Transparent"
                        TextColor="#F44336"
                        FontSize="16"
                        FontAttributes="Bold" />
                </Border>

            </VerticalStackLayout>
        </ScrollView>

        <!-- Bottom Summary Card -->
        <Border
            Grid.Row="1"
            Padding="24"
            BackgroundColor="White"
            StrokeThickness="0"
            IsVisible="{Binding BasketItems.Count, Converter={StaticResource EqualConverter}, ConverterParameter=0, Converter={StaticResource InvertedBoolConverter}}">
            <Border.StrokeShape>
                <RoundRectangle CornerRadius="24,24,0,0" />
            </Border.StrokeShape>
            <Border.Shadow>
                <Shadow Brush="#C0C0C0" Offset="0,-4" Radius="20" Opacity="0.3" />
            </Border.Shadow>

            <VerticalStackLayout Spacing="18">

                <!-- Total Section -->
                <Border
                    Padding="20"
                    BackgroundColor="#F5F3FF"
                    StrokeThickness="0">
                    <Border.StrokeShape>
                        <RoundRectangle CornerRadius="16" />
                    </Border.StrokeShape>
                    <Grid ColumnDefinitions="*,Auto">
                        <Label
                            Grid.Column="0"
                            Text="ðŸ’° Total Amount"
                            FontSize="18"
                            FontAttributes="Bold"
                            TextColor="#1A1A1A"
                            VerticalOptions="Center" />
                        <Label
                            Grid.Column="1"
                            Text="{Binding TotalAmount}"
                            FontSize="32"
                            FontAttributes="Bold"
                            TextColor="#512BD4"
                            VerticalOptions="Center" />
                    </Grid>
                </Border>

                <!-- Checkout Button -->
                <Border
                    StrokeThickness="0">
                    <Border.StrokeShape>
                        <RoundRectangle CornerRadius="16" />
                    </Border.StrokeShape>
                    <Border.Background>
                        <LinearGradientBrush StartPoint="0,0" EndPoint="1,0">
                            <GradientStop Color="#512BD4" Offset="0.0" />
                            <GradientStop Color="#7B4FDB" Offset="1.0" />
                        </LinearGradientBrush>
                    </Border.Background>
                    <Border.Shadow>
                        <Shadow Brush="#512BD4" Offset="0,6" Radius="16" Opacity="0.4" />
                    </Border.Shadow>
                    <Button
                        Text="âœ“ Proceed to Checkout"
                        Command="{Binding CheckoutCommand}"
                        BackgroundColor="Transparent"
                        TextColor="White"
                        FontSize="18"
                        FontAttributes="Bold"
                        HeightRequest="56" />
                </Border>

                <!-- Continue Shopping Link -->
                <Border
                    Padding="16,12"
                    BackgroundColor="Transparent"
                    StrokeThickness="2"
                    Stroke="#512BD4">
                    <Border.StrokeShape>
                        <RoundRectangle CornerRadius="16" />
                    </Border.StrokeShape>
                    <Button
                        Text="â† Continue Shopping"
                        Command="{Binding ContinueShoppingCommand}"
                        BackgroundColor="Transparent"
                        TextColor="#512BD4"
                        FontSize="15"
                        FontAttributes="Bold" />
                </Border>

            </VerticalStackLayout>
        </Border>

    </Grid>

</ContentPage>
